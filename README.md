# 第7次实验报告 #

完结撒花！

## 实验设计 ##

- 用了一些更为奇妙的做法：LLVM IR使用较少。由于前面几次实验设计的原因，导致我这次实验某些LLVM IR难以使用，于是我设计了用放在Visitor中的一个Map去暂存数组，该Map的实现思路同普通整数的Map思路一致。虽然这次实验可行，但是存在一些问题：如果后续增加更多类型，莫不是我得使用更多的Map去存不同的东西？当然我想到了可以用策略模式去实现这样子，具体的改法就懒得搞了。

## 实验难点 ##

- 在函数参数中，如何将普通整数与数组区分好。最后我妥协了，两者使用了不同的Map去记录，并分别建立了不同的索引，这导致代码变得多且不优美，并且耗费了我很长的时间去找这里的bug。
- 忘了考虑初始化赋值的情况。如果初始化的个数与事先声明的数量不匹配，应该在数组后面补0，否则会越界访问或空指针。
- 当stmt为 *exp? ;* 时，应当加以考虑。在做Visit时，一开始我直接跳过了这种情况了（原本认为这种情况是无用的句子），后来发现忘记考虑到exp展开为函数的情况了，如*exp? ;*的*exp*为:*func(a)*，此时若函数内有对一些变量进行修改（因为传的是指针），但我没有访问，于是并没有实际修改到。这个bug也找蛮久的。
